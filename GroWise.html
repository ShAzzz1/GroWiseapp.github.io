<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>GroWise Habit Tracker - Enhanced Mobile</title>
  <style>
    /* Reset & base */
    * {
      box-sizing: border-box;
    }
    body, html {
      margin: 0;
      height: 100%;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      transition: background-color 0.4s ease, color 0.4s ease;
    }
    :root {
      --bg-color: #121212;
      --text-color: #eee;
      --primary-color: #3a86ff;
      --secondary-color: #28a745;
      --danger-color: #dc3545;
      --danger-hover: #b02a37;
      --card-bg: #1e1e1e;
      --input-bg: #222;
      --input-bg-focus: #333;
      --shadow-color: rgba(58,134,255,0.6);
    }
    .light {
      --bg-color: #f9f9f9;
      --text-color: #222;
      --primary-color: #0055ff;
      --secondary-color: #28a745;
      --danger-color: #cc2222;
      --danger-hover: #991b1b;
      --card-bg: #fff;
      --input-bg: #eee;
      --input-bg-focus: #ddd;
      --shadow-color: rgba(0,85,255,0.6);
    }
    /* Animated background */
    #animated-bg {
      pointer-events: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      z-index: -1;
      background:
        radial-gradient(ellipse at center, var(--primary-color) 0%, transparent 80%),
        radial-gradient(ellipse at center, var(--secondary-color) 0%, transparent 70%);
      background-position: 30% 40%, 70% 60%;
      background-repeat: no-repeat;
      background-size: 600px 600px, 400px 400px;
      animation: bgPulse 15s infinite alternate ease-in-out;
    }
    @keyframes bgPulse {
      0% {
        background-size: 600px 600px, 400px 400px;
        background-position: 30% 40%, 70% 60%;
      }
      100% {
        background-size: 650px 650px, 360px 360px;
        background-position: 35% 45%, 65% 55%;
      }
    }

    #app {
      height: 100vh;
      display: flex;
      flex-direction: column;
      max-width: 480px;
      margin: 0 auto;
      border-left: 1px solid #222;
      border-right: 1px solid #222;
      background-color: var(--bg-color);
    }
    header {
      background: var(--card-bg);
      padding: 1rem 1.2rem;
      text-align: center;
      font-size: 1.5rem;
      font-weight: 800;
      box-shadow: 0 1px 10px rgba(0,0,0,0.6);
      flex-shrink: 0;
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      color: var(--text-color);
    }
    header h1 {
      margin: 0; font-weight: 800; font-size:1.4rem; flex: 1;
    }
    /* Theme toggle button */
    #theme-toggle {
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 1.6rem;
      color: var(--primary-color);
      user-select: none;
      padding: 0.2rem 0.3rem;
      transition: color 0.3s ease;
    }
    #theme-toggle:hover, #theme-toggle:focus {
      color: var(--secondary-color);
      outline: none;
    }
    main {
      flex-grow: 1;
      overflow-y: auto;
      padding: 1rem 1rem 3rem 1rem;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
      position: relative;
      z-index: 1;
    }
    input, button, textarea {
      font-size: 1.1rem;
      padding: 0.75rem 1rem;
      border-radius: 12px;
      border: none;
      outline:none;
      width: 100%;
      margin-top: 0.6rem;
      font-weight: 600;
      background: var(--input-bg);
      color: var(--text-color);
      transition: background-color 0.3s ease;
      box-shadow: inset 1px 1px 3px rgba(255,255,255,0.05);
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }
    input::placeholder, textarea::placeholder {
      color: #888888bb;
    }
    input:focus, textarea:focus {
      background: var(--input-bg-focus);
      box-shadow: inset 1px 1px 10px var(--shadow-color);
    }
    button {
      background-color: var(--primary-color);
      color: white;
      cursor: pointer;
      font-weight: 700;
      border: none;
      transition: background-color 0.3s ease, transform 0.1s ease;
      padding: 0.8rem;
      box-shadow: 0 5px 12px var(--shadow-color);
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      -webkit-touch-callout: none;
      border-radius: 12px;
      position: relative;
      overflow: hidden;
    }
    button:hover:not(:disabled),
    button:focus:not(:disabled) {
      background-color: #265fbd;
      box-shadow: 0 7px 18px rgba(29,90,189,0.9);
      outline:none;
    }
    button:active:not(:disabled) {
      transform: scale(0.95);
      box-shadow: 0 3px 7px var(--shadow-color);
    }
    button:disabled {
      background-color: #55555555;
      cursor: not-allowed;
      box-shadow: none;
      color: #ccc;
    }
    label {
      font-weight: 600;
      margin-top: 1.2rem;
      display: block;
      user-select: none;
      color: var(--text-color);
    }
    section {
      margin-bottom: 2rem;
    }
    .hidden {
      display: none !important;
    }
    ul {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }
    li {
      background: var(--card-bg);
      margin-bottom: 0.8rem;
      padding: 1rem 1rem;
      border-radius: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      user-select: none;
      flex-wrap: wrap;
      box-shadow: 0 2px 5px rgba(0,0,0,0.6);
      transition: background-color 0.3s ease;
    }
    li:hover {
      background-color: var(--primary-color);
      color: white;
      box-shadow: 0 6px 14px rgba(58,134,255,0.55);
    }
    .goal-info, .note-info {
      display: flex;
      flex-direction: column;
      max-width: 66%;
      min-width: 60%;
      gap: 0.15rem;
    }
    .goal-desc, .note-text {
      word-break: break-word;
      font-size: 1rem;
      line-height: 1.3;
      user-select: text;
    }
    .goal-time {
      font-size: 0.85rem;
      color: #99bbff;
      font-weight: 500;
      user-select: none;
    }
    .goal-streak {
      font-size: 0.75rem;
      color: #66cc66;
      font-weight: 600;
      user-select: none;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    /* Streak visualization bars */
    .streak-bars {
      display: flex;
      gap: 3px;
      margin-left: 6px;
    }
    .streak-bar {
      width: 10px;
      height: 10px;
      border-radius: 3px;
      background: #339933;
      opacity: 0.6;
      transition: opacity 0.3s ease;
    }
    .streak-bar.active {
      opacity: 1;
      background: #91e56e;
      box-shadow: 0 0 6px #91e56eaa;
    }

    .btn-group {
      display: flex;
      gap: 0.5rem;
      flex-shrink: 0;
      min-width: 32%;
      justify-content: flex-end;
    }
    .btn-tracking {
      background-color: var(--secondary-color);
      flex: 1 1 auto;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-weight: 700;
      font-size: 1rem;
      user-select: none;
      box-shadow: 0 4px 12px rgba(40,167,69,0.7);
      transition: background-color 0.3s ease;
      padding: 0.6rem 1rem;
    }
    .btn-tracking svg {
      width: 20px;
      height: 20px;
      fill: white;
    }
    .btn-tracking:hover {
      background-color: #1e7e34;
      box-shadow: 0 5px 16px rgba(30,126,52,0.9);
    }
    .btn-tracking:disabled {
      background-color: #4caf509e;
      cursor: default;
      box-shadow: none;
      color: #ddffddcc;
    }
    .btn-delete {
      background-color: var(--danger-color);
      flex: 1 1 auto;
      border-radius: 14px;
      padding: 0.6rem 1rem;
      font-weight: 700;
      font-size: 1rem;
      user-select: none;
      box-shadow: 0 4px 12px #cc2a2aaa;
      transition: background-color 0.3s ease;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
    }
    .btn-delete svg {
      width: 18px;
      height: 18px;
      fill: white;
    }
    .btn-delete:hover {
      background-color: var(--danger-hover);
      box-shadow: 0 5px 16px #991b1bad;
    }

    .progress-count {
      font-weight: 700;
      margin-top: 0.5rem;
      color: var(--secondary-color);
      font-size: 1.05rem;
      user-select: text;
    }
    .notification {
      background: #ffdd57;
      color: #563d00;
      padding: 1rem;
      border-radius: 14px;
      border: 1px solid #ccac00;
      margin-bottom: 1rem;
      text-align: center;
      user-select: none;
      font-weight: 700;
      box-shadow: 0 0 9px #ccac0055;
      position: fixed;
      top: 5.5rem;
      left: 50%;
      transform: translateX(-50%);
      max-width: 90vw;
      z-index: 1001;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
    .notification.visible {
      opacity: 1;
      pointer-events: auto;
    }
    .popup {
      position: fixed;
      top: 18%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--secondary-color);
      color: white;
      padding: 1.5rem 2rem;
      border-radius: 18px;
      box-shadow: 0 5px 22px rgba(0,0,0,0.7);
      font-weight: 700;
      text-align: center;
      z-index: 1002;
      display: none;
      font-size: 1.1rem;
      user-select: none;
      max-width: 90vw;
      transition: transform 0.4s ease, opacity 0.4s ease;
      will-change: transform, opacity;
      overflow-wrap: break-word;
    }
    .popup.show {
      display: block;
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    .celebration-popup {
      background: #ff6f61;
    }
    nav {
      display: flex;
      justify-content: space-around;
      background: var(--card-bg);
      padding: 0.85rem 0;
      font-weight: 700;
      box-shadow: 0 -1px 7px rgba(0,0,0,0.85);
      flex-shrink: 0;
      user-select: none;
      position: relative;
      z-index: 2;
    }
    nav button {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.25rem;
      transition: color 0.3s ease;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: none;
      /* Hidden by default, show after login with .visible class */
      color: var(--text-color);
      padding: 0.15rem 0.6rem;
      border-radius: 12px;
    }
    nav button.visible {
      display: inline-block;
    }
    nav button.active, nav button:hover {
      color: var(--primary-color);
      background-color: var(--input-bg-focus);
      outline:none;
      box-shadow: 0 3px 10px var(--shadow-color);
    }

    /* Scroll styling for main */
    main::-webkit-scrollbar {
      width: 7px;
    }
    main::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 7px;
    }
    main::-webkit-scrollbar-track {
      background: var(--bg-color);
    }
    /* Logo container */
    #logo {
      width: 54px;
      height: 54px;
      background: var(--primary-color);
      color: white;
      border-radius: 14px;
      font-weight: 900;
      font-size: 2.1rem;
      display: flex;
      justify-content: center;
      align-items: center;
      user-select: none;
      margin: 0 auto 1rem auto;
      letter-spacing: 4px;
      font-family: 'Segoe UI Black', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    /* Buttons container */
    #login-action-buttons {
      display: flex;
      gap: 1rem;
      margin-top: 1.1rem;
    }
    #login-action-buttons button {
      flex: 1;
      padding: 0.85rem 0;
      border-radius: 12px;
      font-weight: 700;
      font-size: 1.05rem;
      box-shadow: 0 3px 8px var(--shadow-color);
      transition: background-color 0.3s ease;
    }
    /* Splash screen */
    #splash-screen {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: var(--bg-color);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 20000;
      flex-direction: column;
      color: var(--primary-color);
      user-select: none;
      font-weight: 800;
    }
    #splash-logo {
      width: 110px;
      height: 110px;
      background: var(--primary-color);
      color: white;
      border-radius: 20px;
      font-weight: 900;
      font-size: 4rem;
      display: flex;
      justify-content: center;
      align-items: center;
      letter-spacing: 8px;
      font-family: 'Segoe UI Black', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      box-shadow: 0 0 18px 3px #3a86ff88;
      user-select: none;
    }
    #splash-text {
      color: var(--primary-color);
      font-weight: 700;
      margin-top: 1rem;
      font-size: 1.2rem;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      user-select: none;
    }

    /* Custom checkbox for goals */
    .custom-checkbox {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      width: 28px;
      height: 28px;
      border: 3px solid var(--primary-color);
      border-radius: 8px;
      background-color: transparent;
      cursor: pointer;
      position: relative;
      transition: background-color 0.3s ease, border-color 0.3s ease;
      flex-shrink: 0;
    }
    .custom-checkbox:hover {
      border-color: var(--secondary-color);
    }
    .custom-checkbox:checked {
      background-color: var(--secondary-color);
      border-color: var(--secondary-color);
    }
    .custom-checkbox:checked::after {
      content: '';
      position: absolute;
      top: 5px;
      left: 9px;
      width: 6px;
      height: 12px;
      border: solid white;
      border-width: 0 3px 3px 0;
      transform: rotate(45deg);
      animation: checkmarkAnim 0.3s ease forwards;
    }
    @keyframes checkmarkAnim {
      0% {width: 0; height: 0; opacity: 0;}
      100% {width: 6px; height: 12px; opacity: 1;}
    }

    /* Floating Action Button */
    #fab-add-goal {
      position: fixed;
      right: 20px;
      bottom: 70px;
      width: 60px;
      height: 60px;
      background: var(--primary-color);
      border-radius: 50%;
      box-shadow: 0 6px 14px rgba(58,134,255,0.7);
      color: white;
      font-size: 36px;
      line-height: 60px;
      text-align: center;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      z-index: 1003;
      display: none; /* Show only on dashboard */
    }
    #fab-add-goal:hover {
      background-color: #265fbd;
      box-shadow: 0 10px 24px rgba(38,95,189,0.9);
    }
    #fab-add-goal:active {
      transform: scale(0.95);
      box-shadow: 0 5px 10px rgba(38,95,189,0.85);
    }

    /* Mood tracker: simple emoticon buttons */
    #mood-tracker {
      margin-top: 1.5rem;
      user-select: none;
      color: var(--text-color);
    }
    #mood-tracker h3 {
      margin-bottom: 0.6rem;
      font-weight: 700;
      font-size: 1.1rem;
    }
    .mood-buttons {
      display: flex;
      justify-content: space-around;
    }
    .mood-button {
      background: var(--input-bg);
      border-radius: 14px;
      cursor: pointer;
      font-size: 28px;
      padding: 0.3rem 0.6rem;
      transition: background-color 0.25s ease;
      user-select: none;
      border: 2px solid transparent;
      box-shadow: inset 0 0 3px rgba(0,0,0,0.2);
      color: var(--text-color);
    }
    .mood-button.selected {
      background: var(--secondary-color);
      box-shadow: 0 0 10px var(--secondary-color);
      border-color: var(--secondary-color);
      color: white;
    }
    .mood-button:hover {
      background: var(--secondary-color);
      color: white;
      border-color: var(--secondary-color);
    }
    #mood-history {
      margin-top: 0.8rem;
      font-size: 0.85rem;
      color: #999;
      font-family: monospace;
      user-select: text;
    }

    /* Responsive for keyboard opening on mobile */
    textarea, input {
      max-width: 100%;
    }

  </style>
</head>
<body>
  <div id="animated-bg"></div>

  <div id="app" role="main" >
    <header>
      <h1>GroWise Habit Tracker</h1>
      <button id="theme-toggle" title="Switch Theme" aria-label="Switch Theme" tabindex="0">üåô</button>
    </header>

    <!-- Notifications -->
    <div id="notification" class="notification" role="alert" aria-live="assertive"></div>

    <!-- Splash Screen -->
    <section id="splash-screen" aria-label="Loading splash screen" aria-live="off">
      <div id="splash-logo" aria-hidden="true">GW</div>
      <div id="splash-text">GroWise</div>
    </section>

    <!-- Pages -->
    <main aria-hidden="true" tabindex="-1">

      <!-- Login Page -->
      <section id="page-login" aria-label="Login Page" tabindex="-1">
        <div id="logo" aria-hidden="true">GW</div>
        <h2>Welcome to GroWise</h2>
        <label for="username">Username:</label>
        <input type="text" id="username" placeholder="Your username" maxlength="20" autocomplete="off" aria-required="true" />
        <label for="password">Password:</label>
        <input type="password" id="password" placeholder="Your password" autocomplete="off" aria-required="true" />
        <div id="login-action-buttons">
          <button id="login-btn" type="button">Login</button>
          <button id="register-btn" type="button">Register</button>
        </div>
      </section>

      <!-- Dashboard Page -->
      <section id="page-dashboard" class="hidden" aria-label="Dashboard" tabindex="-1">
        <div style="margin-bottom:1rem;">
          <button id="logout-btn" aria-label="Log out and return to login page" style="background:#444; width: 100%;">Logout</button>
        </div>
        <h2 id="greeting">Hello!</h2>

        <div id="daily-quote" style="font-style: italic; margin-bottom: 1rem; max-height: 4.5rem; overflow-y: auto; user-select: text; color: var(--primary-color); font-weight: 600;"></div>

        <!-- Add Goal -->
        <div>
          <h3>Set a New Goal</h3>
          <label for="goal-input">Goal Description:</label>
          <textarea id="goal-input" rows="2" placeholder="Example: Read 10 pages daily" aria-describedby="goal-desc-help"></textarea>
          <div id="goal-desc-help" style="font-size:0.8rem; color:#888;">Describe your habit goal</div>

          <label for="goal-time">Reminder Time:</label>
          <input type="time" id="goal-time" aria-describedby="goal-time-help" />
          <div id="goal-time-help" style="font-size:0.8rem; color:#888;">Set a reminder time for your goal</div>

          <button id="add-goal-btn" type="button">Add Goal</button>
        </div>

        <!-- Goals List -->
        <div style="margin-top: 2rem;">
          <h3>Your Goals & Habit Tracking</h3>
          <ul id="goals-list" aria-live="polite" aria-relevant="additions removals"></ul>
        </div>

        <!-- Progress -->
        <div>
          <h3>Progress</h3>
          <p class="progress-count" id="total-goals">Total Goals: 0</p>
          <p class="progress-count" id="completed-goals">Completed Today: 0</p>
          <button id="reset-today-btn" style="background:#ff4d4d; margin-top:0.5rem;" type="button">Reset Today's Completion</button>
        </div>

        <!-- Mood Tracker -->
        <div id="mood-tracker" aria-label="Mood Tracker">
          <h3>How are you feeling today?</h3>
          <div class="mood-buttons" role="radiogroup" aria-labelledby="mood-tracker-label">
            <button class="mood-button" data-mood="üòÉ" aria-label="Happy" role="radio" tabindex="0">üòÉ</button>
            <button class="mood-button" data-mood="üòê" aria-label="Neutral" role="radio" tabindex="-1">üòê</button>
            <button class="mood-button" data-mood="üòû" aria-label="Sad" role="radio" tabindex="-1">üòû</button>
            <button class="mood-button" data-mood="üò†" aria-label="Angry" role="radio" tabindex="-1">üò†</button>
            <button class="mood-button" data-mood="üò¥" aria-label="Tired" role="radio" tabindex="-1">üò¥</button>
          </div>
          <div id="mood-history" aria-live="polite"></div>
        </div>
      </section>

      <!-- Records Page -->
      <section id="page-records" class="hidden" aria-label="Records" tabindex="-1">
        <button id="records-back-btn" style="background:#444; margin-bottom:1rem; width: 100%;">Back to Dashboard</button>
        <h2>Habit Completion Records</h2>
        <ul id="records-list" aria-live="polite" aria-relevant="additions removals"></ul>
        <p id="no-records-msg" style="color:#888; display:none; margin-top:1rem;">No habit completion records found.</p>
      </section>

      <!-- Notes Page -->
      <section id="page-notes" class="hidden" aria-label="Notes" tabindex="-1">
        <button id="notes-back-btn" style="background:#444; margin-bottom:1rem; width: 100%;">Back to Dashboard</button>
        <h2>Your Notes</h2>
        <label for="note-input">Add a Note:</label>
        <textarea id="note-input" rows="3" placeholder="Write your note here..."></textarea>
        <button id="add-note-btn" type="button">Add Note</button>
        <ul id="notes-list" aria-live="polite" aria-relevant="additions removals" style="margin-top:1rem;"></ul>
        <p id="no-notes-msg" style="color:#888; display:none; margin-top:1rem;">No notes yet. Add one!</p>
      </section>

    </main>

    <!-- Floating Action Button - Add Goal -->
    <button id="fab-add-goal" aria-label="Add New Goal" title="Add New Goal" type="button">Ôºã</button>

    <nav aria-label="Main Navigation">
      <button id="nav-dashboard-btn" class="visible active" aria-controls="page-dashboard" aria-selected="true" type="button">Dashboard</button>
      <button id="nav-records-btn" class="visible" aria-controls="page-records" aria-selected="false" type="button">Records</button>
      <button id="nav-notes-btn" class="visible" aria-controls="page-notes" aria-selected="false" type="button">Notes</button>
    </nav>

    <!-- Popups -->
    <div id="reward-popup" class="popup" role="alert" aria-live="assertive"></div>
    <div id="celebration-popup" class="popup celebration-popup" role="alert" aria-live="assertive">üéâ Well done! Keep up the great work! üéâ</div>
  </div>

  <script>
    (() => {
      const splashScreen = document.getElementById('splash-screen');
      const mainEl = document.querySelector('main');
      const loginSection = document.getElementById('page-login');
      const dashboardSection = document.getElementById('page-dashboard');
      const recordsSection = document.getElementById('page-records');
      const notesSection = document.getElementById('page-notes');
      const usernameInput = document.getElementById('username');
      const passwordInput = document.getElementById('password');
      const loginBtn = document.getElementById('login-btn');
      const registerBtn = document.getElementById('register-btn');
      const logoutBtn = document.getElementById('logout-btn');
      const greeting = document.getElementById('greeting');
      const goalInput = document.getElementById('goal-input');
      const goalTimeInput = document.getElementById('goal-time');
      const addGoalBtn = document.getElementById('add-goal-btn');
      const goalsList = document.getElementById('goals-list');
      const totalGoalsElem = document.getElementById('total-goals');
      const completedGoalsElem = document.getElementById('completed-goals');
      const resetTodayBtn = document.getElementById('reset-today-btn');
      const notification = document.getElementById('notification');
      const rewardPopup = document.getElementById('reward-popup');
      const celebrationPopup = document.getElementById('celebration-popup');
      const navDashboardBtn = document.getElementById('nav-dashboard-btn');
      const navRecordsBtn = document.getElementById('nav-records-btn');
      const navNotesBtn = document.getElementById('nav-notes-btn');
      const recordsList = document.getElementById('records-list');
      const noRecordsMsg = document.getElementById('no-records-msg');
      const recordsBackBtn = document.getElementById('records-back-btn');
      const notesBackBtn = document.getElementById('notes-back-btn');
      const noteInput = document.getElementById('note-input');
      const addNoteBtn = document.getElementById('add-note-btn');
      const notesList = document.getElementById('notes-list');
      const noNotesMsg = document.getElementById('no-notes-msg');
      const fabAddGoal = document.getElementById('fab-add-goal');
      const themeToggleBtn = document.getElementById('theme-toggle');
      const dailyQuoteElem = document.getElementById('daily-quote');
      const moodButtons = [...document.querySelectorAll('.mood-button')];
      const moodHistoryElem = document.getElementById('mood-history');

      let username = null;
      let goals = [];
      let records = [];
      let notes = [];
      let moods = [];

      const USERS_KEY = 'groWise_users';
      const MOODS_KEY_PREFIX = 'groWise_moods_';

      /****************************
       * UTILS
       ****************************/
      function showNotification(message) {
        if(!message) return;
        notification.textContent = message;
        notification.classList.add('visible');
        clearTimeout(notification._timeout);
        notification._timeout = setTimeout(() => notification.classList.remove('visible'), 3000);
      }

      function showPopup(elem) {
        elem.classList.add('show');
        clearTimeout(elem._timeout);
        elem._timeout = setTimeout(() => {
          elem.classList.remove('show');
        }, 3000);
      }
      function showReward(message) {
        rewardPopup.textContent = message;
        showPopup(rewardPopup);
      }
      function showCelebration() {
        showPopup(celebrationPopup);
      }

      function saveData() {
        if (username) {
          localStorage.setItem(`groWise_goals_${username}`, JSON.stringify(goals));
          localStorage.setItem(`groWise_records_${username}`, JSON.stringify(records));
          localStorage.setItem(`groWise_notes_${username}`, JSON.stringify(notes));
          localStorage.setItem(`${MOODS_KEY_PREFIX}${username}`, JSON.stringify(moods));
        }
      }

      function loadData() {
        if (username) {
          const savedGoals = localStorage.getItem(`groWise_goals_${username}`);
          const savedRecords = localStorage.getItem(`groWise_records_${username}`);
          const savedNotes = localStorage.getItem(`groWise_notes_${username}`);
          const savedMoods = localStorage.getItem(`${MOODS_KEY_PREFIX}${username}`);
          goals = savedGoals ? JSON.parse(savedGoals) : [];
          records = savedRecords ? JSON.parse(savedRecords) : [];
          notes = savedNotes ? JSON.parse(savedNotes) : [];
          moods = savedMoods ? JSON.parse(savedMoods) : [];
        }
      }

      // Format date YYYY-MM-DD string
      function localDateString(offsetDays=0){
        const d = new Date();
        d.setDate(d.getDate() + offsetDays);
        return d.toISOString().slice(0,10);
      }
      // Get last n mood days from moods array
      function getLastMoodHistory(n=7){
        const result = [];
        for(let i = n-1; i >=0; i--){
          const d = localDateString(-i);
          const moodObj = moods.find(m=>m.date===d);
          result.push(moodObj ? moodObj.mood : '‚Äì');
        }
        return result;
      }

      // Simple hash for password (not secure!)
      function simpleHash(str) {
        let hash = 0;
        for(let i=0; i < str.length; i++) {
          hash = ((hash<<5) - hash) + str.charCodeAt(i);
          hash |= 0;
        }
        return hash.toString();
      }

      /****************************
       * RENDER FUNCTIONS
       ****************************/
      function renderGoals() {
        goalsList.innerHTML = '';
        if(goals.length === 0) {
          const noGoalLI = document.createElement('li');
          noGoalLI.textContent = 'No goals added yet. Add a goal to get started!';
          noGoalLI.style.textAlign = 'center';
          noGoalLI.style.color = '#888';
          goalsList.appendChild(noGoalLI);
          updateProgress();
          return;
        }

        goals.forEach((goal, index) => {
          const li = document.createElement('li');
          li.tabIndex = 0;

          const info = document.createElement('div');
          info.className = 'goal-info';
          // Custom checkbox + description container
          const descCont = document.createElement('label');
          descCont.style.display = 'flex';
          descCont.style.alignItems = 'center';
          descCont.style.gap = '14px';
          descCont.style.cursor = 'pointer';
          descCont.style.userSelect = 'none';

          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.className = 'custom-checkbox';
          checkbox.checked = goal.doneToday;
          checkbox.title = 'Mark goal as done for today';
          checkbox.setAttribute('aria-checked', goal.doneToday);
          checkbox.setAttribute('role','checkbox');
          checkbox.tabIndex = -1;

          // Sync disabled state if done
          checkbox.disabled = goal.doneToday;

          // When user toggles checkbox
          checkbox.addEventListener('change', () => {
            if(checkbox.checked && !goal.doneToday) {
              goal.doneToday = true;
              goal.streak = (goal.streak || 0) + 1;
              const todayDate = localDateString();
              records.push({date: todayDate, description: goal.description});
              saveData();
              renderGoals();
              updateProgress();
              showCelebration();
              if (goal.streak > 0 && goal.streak % 3 === 0) {
                showReward(`üéâ Congrats! "${goal.description}" streak: ${goal.streak} days!`);
              }
            }
            checkbox.disabled = goal.doneToday;
            checkbox.setAttribute('aria-checked', goal.doneToday);
          });

          const descSpan = document.createElement('span');
          descSpan.className = 'goal-desc';
          descSpan.textContent = goal.description;

          descCont.appendChild(checkbox);
          descCont.appendChild(descSpan);

          // Reminder time
          const timeSpan = document.createElement('div');
          timeSpan.className = 'goal-time';
          timeSpan.textContent = goal.reminderTime ? `‚è∞ ${goal.reminderTime}` : '';

          // Streak visualization - bars max 10
          const streakSpan = document.createElement('div');
          streakSpan.className = 'goal-streak';
          streakSpan.textContent = `üî• ${goal.streak || 0} day${(goal.streak||0) !== 1 ? 's' : ''}`;

          const bars = document.createElement('div');
          bars.className = 'streak-bars';
          let maxBars = 10;
          for(let i=0; i<maxBars;i++){
            let bar = document.createElement('div');
            bar.className = 'streak-bar';
            if(i < (goal.streak || 0)) bar.classList.add('active');
            bars.appendChild(bar);
          }
          streakSpan.appendChild(bars);

          info.appendChild(descCont);
          info.appendChild(timeSpan);
          info.appendChild(streakSpan);

          const btnGroup = document.createElement('div');
          btnGroup.className = 'btn-group';

          const deleteBtn = document.createElement('button');
          deleteBtn.className = 'btn-delete';
          deleteBtn.title = 'Delete this goal';
          deleteBtn.type = 'button';
          deleteBtn.setAttribute('aria-label', `Delete goal: ${goal.description}`);

          deleteBtn.innerHTML = 'üóëÔ∏è Delete';

          deleteBtn.addEventListener('click', () => {
            if(confirm(`Delete goal: "${goal.description}"?`)) {
              goals.splice(index, 1);
              saveData();
              renderGoals();
              updateProgress();
            }
          });

          btnGroup.appendChild(deleteBtn);

          li.appendChild(info);
          li.appendChild(btnGroup);
          goalsList.appendChild(li);
        });
        updateProgress();
      }

      function updateProgress() {
        const total = goals.length;
        const completed = goals.filter(g => g.doneToday).length;
        totalGoalsElem.textContent = `Total Goals: ${total}`;
        completedGoalsElem.textContent = `Completed Today: ${completed}`;
      }

      function renderRecords() {
        recordsList.innerHTML = '';
        if(records.length === 0) {
          noRecordsMsg.style.display = 'block';
          return;
        }
        noRecordsMsg.style.display = 'none';

        const grouped = {};
        records.forEach(rec => {
          if(!grouped[rec.date]) grouped[rec.date] = [];
          grouped[rec.date].push(rec.description);
        });

        const dates = Object.keys(grouped).sort((a,b) => (a < b ? 1 : -1));

        dates.forEach(date => {
          const li = document.createElement('li');
          li.style.flexDirection = 'column';
          li.style.alignItems = 'flex-start';
          li.style.color = '#aaa';

          const dateDiv = document.createElement('div');
          const dateObj = new Date(date);
          dateDiv.textContent = dateObj.toLocaleDateString(undefined, {year:'numeric', month:'short', day:'numeric'});
          dateDiv.style.fontWeight = '700';
          dateDiv.style.marginBottom = '0.3rem';

          li.appendChild(dateDiv);

          grouped[date].forEach(desc => {
            const habitDiv = document.createElement('div');
            habitDiv.textContent = `‚Ä¢ ${desc}`;
            habitDiv.style.color = '#ccc';
            habitDiv.style.marginLeft = '1rem';
            li.appendChild(habitDiv);
          });

          recordsList.appendChild(li);
        });
      }

      function renderNotes() {
        notesList.innerHTML = '';
        if(notes.length === 0) {
          noNotesMsg.style.display = 'block';
          return;
        }
        noNotesMsg.style.display = 'none';

        notes.forEach((note, index) => {
          const li = document.createElement('li');
          const info = document.createElement('div');
          info.className = 'note-info';
          const textDiv = document.createElement('div');
          textDiv.className = 'note-text';
          textDiv.textContent = note.text;

          info.appendChild(textDiv);

          const btnGroup = document.createElement('div');
          btnGroup.className = 'btn-group';

          const deleteBtn = document.createElement('button');
          deleteBtn.className = 'btn-delete';
          deleteBtn.title = 'Delete this note';
          deleteBtn.type = 'button';
          deleteBtn.innerHTML = 'üóëÔ∏è Delete';

          deleteBtn.addEventListener('click', () => {
            if(confirm('Delete this note?')) {
              notes.splice(index, 1);
              saveData();
              renderNotes();
            }
          });

          btnGroup.appendChild(deleteBtn);

          li.appendChild(info);
          li.appendChild(btnGroup);
          notesList.appendChild(li);
        });
      }

      function resetToday() {
        goals.forEach(goal => {
          goal.doneToday = false;
        });
        saveData();
        renderGoals();
        showNotification("Today's completion status reset!");
      }

      /****************************
       * PAGE & NAVIGATION
       ****************************/
      function showPage(page) {
        loginSection.classList.add('hidden');
        dashboardSection.classList.add('hidden');
        recordsSection.classList.add('hidden');
        notesSection.classList.add('hidden');
        navDashboardBtn.classList.remove('active');
        navDashboardBtn.setAttribute('aria-selected', 'false');
        navRecordsBtn.classList.remove('active');
        navRecordsBtn.setAttribute('aria-selected', 'false');
        navNotesBtn.classList.remove('active');
        navNotesBtn.setAttribute('aria-selected', 'false');

        fabAddGoal.style.display = 'none';

        switch(page) {
          case 'login':
            loginSection.classList.remove('hidden');
            mainEl.setAttribute('aria-hidden', 'false');
            usernameInput.focus();
            break;
          case 'dashboard':
            dashboardSection.classList.remove('hidden');
            mainEl.setAttribute('aria-hidden', 'false');
            navDashboardBtn.classList.add('active');
            navDashboardBtn.setAttribute('aria-selected', 'true');
            addGoalBtn.focus();
            fabAddGoal.style.display = 'block';
            break;
          case 'records':
            recordsSection.classList.remove('hidden');
            mainEl.setAttribute('aria-hidden', 'false');
            navRecordsBtn.classList.add('active');
            navRecordsBtn.setAttribute('aria-selected', 'true');
            renderRecords();
            recordsBackBtn.focus();
            break;
          case 'notes':
            notesSection.classList.remove('hidden');
            mainEl.setAttribute('aria-hidden', 'false');
            navNotesBtn.classList.add('active');
            navNotesBtn.setAttribute('aria-selected', 'true');
            renderNotes();
            noteInput.focus();
            break;
        }
      }

      // Show/hide nav buttons depending on login state
      function updateNavVisibility(loggedIn) {
        if (loggedIn) {
          navDashboardBtn.classList.add('visible');
          navRecordsBtn.classList.add('visible');
          navNotesBtn.classList.add('visible');
        } else {
          navDashboardBtn.classList.remove('visible');
          navRecordsBtn.classList.remove('visible');
          navNotesBtn.classList.remove('visible');
          fabAddGoal.style.display = 'none';
        }
      }

      /****************************
       * THEME TOGGLER
       ****************************/
      function loadThemeFromStorage(){
        const theme = localStorage.getItem('groWise_theme');
        if(theme === 'light'){
          document.documentElement.classList.add('light');
          themeToggleBtn.textContent = 'üåû';
          themeToggleBtn.setAttribute('aria-label','Switch to dark theme');
        } else {
          document.documentElement.classList.remove('light');
          themeToggleBtn.textContent = 'üåô';
          themeToggleBtn.setAttribute('aria-label','Switch to light theme');
        }
      }
      function toggleTheme(){
        const isLight = document.documentElement.classList.toggle('light');
        if(isLight){
          themeToggleBtn.textContent = 'üåû';
          themeToggleBtn.setAttribute('aria-label','Switch to dark theme');
          localStorage.setItem('groWise_theme','light');
        } else {
          themeToggleBtn.textContent = 'üåô';
          themeToggleBtn.setAttribute('aria-label','Switch to light theme');
          localStorage.setItem('groWise_theme','dark');
        }
      }

      /****************************
       * DAILY QUOTE
       ****************************/
      // Fetch daily quote from quotable.io
      async function fetchDailyQuote(){
        try {
          const response = await fetch('https://api.quotable.io/random?tags=motivational|inspirational');
          if(!response.ok) throw new Error('Failed to fetch quote');
          const data = await response.json();
          dailyQuoteElem.textContent = `"${data.content}" ‚Äî ${data.author}`;
        } catch(e) {
          // fallback
          dailyQuoteElem.textContent = '"Stay positive. Work hard. Make it happen."';
        }
      }

      /****************************
       * MOOD TRACKER
       ****************************/
      function renderMoodHistory(){
        let last7 = getLastMoodHistory(7);
        moodHistoryElem.textContent = 'Last 7 days moods: ' + last7.join(' ');
      }
      function saveMood(mood){
        const today = localDateString();
        // update existing
        const existingIndex = moods.findIndex(m=>m.date === today);
        if(existingIndex >= 0){
          moods[existingIndex].mood = mood;
        } else {
          moods.push({date: today, mood});
          if(moods.length > 30) moods.shift(); // keep last 30 moods max
        }
        saveData();
        renderMoodHistory();
        showNotification(`Mood for today saved: ${mood}`);
      }

      function moodButtonSelect(mood){
        moodButtons.forEach(btn => {
          btn.classList.toggle('selected', btn.dataset.mood === mood);
          btn.setAttribute('aria-checked', btn.dataset.mood === mood);
          btn.tabIndex = btn.dataset.mood === mood ? 0 : -1;
        });
      }

      function initMoodTracker(){
        moodButtons.forEach(btn => {
          btn.addEventListener('click', () => {
            let mood = btn.dataset.mood;
            saveMood(mood);
            moodButtonSelect(mood);
          });
          btn.addEventListener('keydown', (e) => {
            // Left/right arrow navigation for radio group
            let idx = moodButtons.indexOf(e.target);
            if(e.key === 'ArrowRight'){
              e.preventDefault();
              let nextIdx = (idx+1) % moodButtons.length;
              moodButtons[nextIdx].focus();
            } else if(e.key === 'ArrowLeft'){
              e.preventDefault();
              let prevIdx = (idx - 1 + moodButtons.length) % moodButtons.length;
              moodButtons[prevIdx].focus();
            }
          });
        });
      }

      function loadMoodSelection(){
        if(!username) return;
        const today = localDateString();
        const moodToday = moods.find(m=>m.date===today);
        if(moodToday){
          moodButtonSelect(moodToday.mood);
        } else {
          // No mood for today, reset selection
          moodButtons.forEach(btn => {
            btn.classList.remove('selected');
            btn.setAttribute('aria-checked', false);
            btn.tabIndex = -1;
          });
          // set first button tabIndex 0 for accessibility
          if(moodButtons.length > 0) moodButtons[0].tabIndex = 0;
        }
      }


      /***************************
       * EVENT LISTENERS
       ***************************/
      loginBtn.addEventListener('click', () => {
        const user = usernameInput.value.trim();
        const pass = passwordInput.value;
        if(user.length < 1) {
          showNotification('Please enter your username');
          return;
        }
        if(pass.length < 4) {
          showNotification('Password must be at least 4 characters');
          return;
        }
        let users = JSON.parse(localStorage.getItem(USERS_KEY)) || {};
        const hashedPass = simpleHash(pass);

        if(users[user]) {
          if(users[user] === hashedPass) {
            username = user;
            greeting.textContent = `Hello, ${username}!`;
            loadData();
            renderGoals();
            updateNavVisibility(true);
            loadMoodSelection();
            showPage('dashboard');
            usernameInput.value = '';
            passwordInput.value = '';
            fetchDailyQuote();
            showNotification('Login successful!');
          } else {
            showNotification('Incorrect password');
          }
        } else {
          showNotification('User does not exist. Please Register.');
        }
      });

      registerBtn.addEventListener('click', () => {
        const user = usernameInput.value.trim();
        const pass = passwordInput.value;
        if(user.length < 1) {
          showNotification('Please enter a username');
          return;
        }
        if(pass.length < 4) {
          showNotification('Password must be at least 4 characters');
          return;
        }
        let users = JSON.parse(localStorage.getItem(USERS_KEY)) || {};
        if(users[user]) {
          showNotification('Username already exists, pick another');
          return;
        }
        const hashedPass = simpleHash(pass);
        users[user] = hashedPass;
        localStorage.setItem(USERS_KEY, JSON.stringify(users));
        username = user;
        goals = [];
        records = [];
        notes = [];
        moods = [];
        saveData();
        greeting.textContent = `Hello, ${username}!`;
        renderGoals();
        updateNavVisibility(true);
        loadMoodSelection();
        showPage('dashboard');
        usernameInput.value = '';
        passwordInput.value = '';
        fetchDailyQuote();
        showNotification('User registered and logged in!');
      });

      logoutBtn.addEventListener('click', () => {
        if(confirm('Are you sure you want to logout?')) {
          username = null;
          goals = [];
          records = [];
          notes = [];
          moods = [];
          updateNavVisibility(false);
          showPage('login');
          dailyQuoteElem.textContent = '';
        }
      });

      addGoalBtn.addEventListener('click', () => {
        const desc = goalInput.value.trim();
        const time = goalTimeInput.value;
        if(desc.length < 3) {
          showNotification('Goal description must be at least 3 characters long');
          return;
        }
        goals.push({description: desc, doneToday: false, streak: 0, reminderTime: time});
        goalInput.value = '';
        goalTimeInput.value = '';
        saveData();
        renderGoals();
        showNotification('Goal added!');
      });

      resetTodayBtn.addEventListener('click', resetToday);

      addNoteBtn.addEventListener('click', () => {
        const text = noteInput.value.trim();
        if(text.length < 1) {
          showNotification('Note cannot be empty');
          return;
        }
        notes.push({text});
        noteInput.value = '';
        saveData();
        renderNotes();
        showNotification('Note added!');
      });

      navDashboardBtn.addEventListener('click', () => {
        if(username) showPage('dashboard');
      });
      navRecordsBtn.addEventListener('click', () => {
        if(username) showPage('records');
      });
      navNotesBtn.addEventListener('click', () => {
        if(username) showPage('notes');
      });
      recordsBackBtn.addEventListener('click', () => {
        if(username) showPage('dashboard');
      });
      notesBackBtn.addEventListener('click', () => {
        if(username) showPage('dashboard');
      });

      fabAddGoal.addEventListener('click', () => {
        // Show focus to goal input and switch to dashboard page
        if(username){
          showPage('dashboard');
          goalInput.focus();
          // Smooth scroll to goal input because content might be scrolled down
          setTimeout(() => goalInput.scrollIntoView({behavior:'smooth', block:'center'}), 100);
        }
      });

      themeToggleBtn.addEventListener('click', toggleTheme);

      /****************************
       * INIT
       ****************************/
      initMoodTracker();
      loadThemeFromStorage();

      setTimeout(() => {
        if(splashScreen) splashScreen.style.display = 'none';
        if(mainEl) mainEl.setAttribute('aria-hidden', 'false');
        updateNavVisibility(false);
        showPage('login');
      }, 1500);
    })();
  </script>
</body>
</html>


